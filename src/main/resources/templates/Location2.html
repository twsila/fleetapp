<!doctype html>
<html lang="en">
  <!--begin::Head-->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Location Management Page</title>

    <!--begin::Accessibility Meta Tags-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="color-scheme" content="light dark" />
    <meta name="theme-color" content="#007bff" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1a1a1a" media="(prefers-color-scheme: dark)" />
    <!--end::Accessibility Meta Tags-->

    <!--begin::Primary Meta Tags-->
    <meta name="title" content="AdminLTE 4 | Simple Tables" />
    <meta name="author" content="ColorlibHQ" />
    <meta
      name="description"
      content="AdminLTE is a Free Bootstrap 5 Admin Dashboard, 30 example pages using Vanilla JS. Fully accessible with WCAG 2.1 AA compliance."
    />
    <meta
      name="keywords"
      content="bootstrap 5, bootstrap, bootstrap 5 admin dashboard, bootstrap 5 dashboard, bootstrap 5 charts, bootstrap 5 calendar, bootstrap 5 datepicker, bootstrap 5 tables, bootstrap 5 datatable, vanilla js datatable, colorlibhq, colorlibhq dashboard, colorlibhq admin dashboard, accessible admin panel, WCAG compliant"
    />
    <!--end::Primary Meta Tags-->

    <!--begin::Accessibility Features-->
    <!-- Skip links will be dynamically added by accessibility.js -->
    <meta name="supported-color-schemes" content="light dark" />
    <link rel="preload" href="../css/adminlte.css" as="style" />
    <!--end::Accessibility Features-->

    <!--begin::Fonts-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
      integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q="
      crossorigin="anonymous"
      media="print"
      onload="this.media='all'"
    />
    <!--end::Fonts-->

    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/styles/overlayscrollbars.min.css"
      crossorigin="anonymous"
    />
    <!--end::Third Party Plugin(OverlayScrollbars)-->

    <!--begin::Third Party Plugin(Bootstrap Icons)-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
      crossorigin="anonymous"
    />
    <!--end::Third Party Plugin(Bootstrap Icons)-->

    <!--begin::Required Plugin(AdminLTE)-->
    <link rel="stylesheet" href="../css/adminlte.css" />
    <!--end::Required Plugin(AdminLTE)-->
  </head>
  <!--end::Head-->
  <!--begin::Body-->
  <body class="layout-fixed sidebar-expand-lg sidebar-open bg-body-tertiary">
    <!--begin::App Wrapper-->
    <div class="app-wrapper">
      <!--begin::Sidebar-->
	  <!-- *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*= -->
	  <div th:replace="aside :: sidebar"></div>
	  <!-- *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*= -->      <!--end::Sidebar-->
      <!--begin::App Main-->
	  <!--begin::App Main-->

	  <main class="app-main">
	    <!--begin::App Content Header-->
	    <div class="app-content-header">
	      <!--begin::Container-->
	      <div class="container-fluid">
	        <!--begin::Row-->
	        <div class="row">
	          <div class="col-sm-6">
	            <h3 class="mb-0">List of Locations</h3>
	          </div>
	        </div>
	        <!--end::Row-->
	      </div>
	      <!--end::Container-->
	    </div>
	    <!--end::App Content Header-->
	    <!--begin::App Content-->
	    <div class="app-content">
	      <!--begin::Container-->
	      <div class="container-fluid">
	        <!--begin::Row-->
	        <div class="row">
	          <div class="col-md-6">
	            <div class="card mb-4">
	              <div class="card-header">
	  			<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">
	  			  New Location
	  			</button>
	              </div>
	              <!-- /.card-header -->
	              <div class="card-body">
	                <table class="table table-bordered">
	                  <thead>
	                    <tr>
	                      <th style="width: 10px">id</th>
	                      <th>City</th>
	                      <th>Address</th>	                      
	  				  <th>Actions</th>
	                    </tr>
	                  </thead>
	                  <tbody>
	                    <tr th:each="location:${locations}" class="align-middle">
	                      <td th:text="${location.id}"></td>
	                      <td th:text="${location.city}"></td>
	                      <td th:text="${location.address}"></td>
	  				  <td>
	  					<div class="btn-group">
	  						<a th:href="@{/locations/findById(id=${location.id})}" class="btn btn-primary editButton"><i class="bi bi-pencil"></i></a>
	  						<a class="btn btn-success detailsButton"><i class="bi bi-file-earmark-text"></i></a>													
	  						<a th:href="@{/locations/delete(id=${location.id})}"   class="btn btn-danger deleteButton"><i class="bi bi-x-circle"></i></a>
	  					</div>
	  				  </td>
	                    </tr>
	  				
	                  </tbody>
	                </table>
	              </div>
	              <!-- /.card-body -->
	            </div>
	            <!-- /.card -->
	            <!-- /.card -->
	          </div>
	          <!-- /.col -->
	            <!-- /.card -->
	          </div>
	          <!-- /.col -->
	        </div>
	        <!--end::Row-->
	      </div>
	      <!--end::Container-->
	    </div>
	    <!--end::App Content-->
	  </main>

	 
      <!--end::App Main-->
      <!--begin::Footer-->
      <footer class="app-footer">
        <!--begin::To the end-->
        <div class="float-end d-none d-sm-inline">Anything you want</div>
        <!--end::To the end-->
        <!--begin::Copyright-->
        <strong>
          Copyright &copy; 2014-2025&nbsp;
          <a href="https://adminlte.io" class="text-decoration-none">AdminLTE.io</a>.
        </strong>
        All rights reserved.
        <!--end::Copyright-->
      </footer>
      <!--end::Footer-->
    </div>
    <!--end::App Wrapper-->
	<!--begin::Modal Section-->

		<!-- *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*	add Modal	 *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*= -->
		<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="addModalLabel">Add Location</h5>
		        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		      </div>

		      <div class="modal-body">
		        <form th:action="@{/locations/addNew}" method="post">
		          <div class="mb-3">
		            <label for="description" class="form-label">Description:</label>
		            <input type="text" class="form-control" id="description" name="description" />
		          </div>
		          <div class="mb-3">
		            <label for="city" class="form-label">City:</label>
		            <input type="text" class="form-control" id="city" name="city" />
		          </div>
		          <div class="mb-3">
		            <label for="address" class="form-label">Address:</label>
		            <input type="text" class="form-control" id="address" name="address" />
		          </div>
		          <div class="mb-3">
		            <label for="countryid" class="form-label">Country:</label>
		            <select class="form-control" id="countryid" name="countryid" required>
		              <option value="">-SELECT-</option>
		              <option th:each="country : ${countries}"
		                      th:value="${country.id}"
		                      th:text="${country.description}"></option>
		            </select>
		          </div>
		          <div class="mb-3">
		            <label for="stateid" class="form-label">State:</label>
		            <select class="form-control" id="stateid" name="stateid" required>
		              <option value="">-SELECT-</option>
		              <!-- Initially empty, will be filled dynamically -->
		            </select>
		          </div>
		          <div class="mb-3">
		            <label for="details" class="form-label">Details:</label>
		            <input type="text" class="form-control" id="details" name="details" />
		          </div>
		          <div class="modal-footer px-0">
		            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		            <button type="submit" class="btn btn-primary">Submit</button>
		          </div>
		        </form>
		      </div>
		    </div>
		  </div>
		</div>

		<!-- *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*= -->	
		
		<!-- *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*	edit Modal	 *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*= -->

		<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">

		      <div class="modal-header">
		        <h5 class="modal-title" id="editModalLabel">Update Location</h5>
		        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		      </div>

		      <div class="modal-body">
		        <form th:action="@{/locations/update}" method="post">
		          <!-- Hidden input to spoof PUT if you use HiddenHttpMethodFilter -->
		          <input type="hidden" name="_method" value="put" />

		          <div class="mb-3">
		            <label for="idEdit" class="form-label">ID:</label>
		            <input type="text" class="form-control" id="idEdit" name="id" readonly />
		          </div>
		          <div class="mb-3">
		            <label for="descriptionEdit" class="form-label">Description:</label>
		            <input type="text" class="form-control" id="descriptionEdit" name="description" />
		          </div>
		          <div class="mb-3">
		            <label for="cityEdit" class="form-label">City:</label>
		            <input type="text" class="form-control" id="cityEdit" name="city" />
		          </div>
		          <div class="mb-3">
		            <label for="addressEdit" class="form-label">Address:</label>
		            <input type="text" class="form-control" id="addressEdit" name="address" />
		          </div>
		          <div class="mb-3">
		            <label for="countryEdit" class="form-label">Country:</label>
		            <select class="form-control" id="countryEdit" name="countryid" required>
		              <option value="">-SELECT-</option>
		              <option th:each="country : ${countries}"
		                      th:value="${country.id}"
		                      th:text="${country.description}"></option>
		            </select>
		          </div>
		          <div class="mb-3">
		            <label for="stateEdit" class="form-label">State:</label>
		            <select class="form-control" id="stateEdit" name="stateid" required>
		              <option value="">-SELECT-</option>
		              <!-- Will be dynamically filled -->
		            </select>
		          </div>
		          <div class="mb-3">
		            <label for="detailsEdit" class="form-label">Details:</label>
		            <input type="text" class="form-control" id="detailsEdit" name="details" />
		          </div>
		          <div class="modal-footer px-0">
		            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		            <button type="submit" class="btn btn-primary">Submit</button>
		          </div>
		        </form>
		      </div>

		    </div>
		  </div>
		</div>
					
		<!-- *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*= -->	
		<!-- *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*	delete Modal *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*= -->	
		<div class="modal" id="deleteModal" tabindex="-1" role="dialog">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title">Confirm Delete!!</h5>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
		      <div class="modal-body">
		        <p>Are you sure you want to delete this record?!</p>
		      </div>
		      <div class="modal-footer">
		        <a class="btn btn-primary" id="confirmDeleteRecord" href="">Yes, Delete</a>
				<button type="button" class="btn btn-scondary" data-dismiss="modal">Cancel</button>
		      </div>
		    </div>
		  </div>
		</div>
		<!-- *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*= -->        
	<!--end::Modal Section-->	
    <!--begin::Script-->
    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <script
      src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/browser/overlayscrollbars.browser.es6.min.js"
      crossorigin="anonymous"
    ></script>
    <!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Required Plugin(popperjs for Bootstrap 5)-->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      crossorigin="anonymous"
    ></script>
    <!--end::Required Plugin(popperjs for Bootstrap 5)--><!--begin::Required Plugin(Bootstrap 5)-->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js"
      crossorigin="anonymous"
    ></script>
    <!--end::Required Plugin(Bootstrap 5)--><!--begin::Required Plugin(AdminLTE)-->
    <script src="../js/adminlte.js"></script>
	<!--script src="../js/location.js"></script-->
	<script>
	      document.addEventListener("DOMContentLoaded", function () {
	        // --- Edit Modal population ---
	        const editButtons = document.querySelectorAll(".editButton");
	        editButtons.forEach(function (button) {
	          button.addEventListener("click", function (event) {
	            event.preventDefault();
	            const href = this.getAttribute("href");

	            fetch(href)
	              .then(response => response.json())
	              .then(location => {
	                document.getElementById("idEdit").value = location.id;
	                document.getElementById("descriptionEdit").value = location.description;
	                document.getElementById("cityEdit").value = location.city;
	                document.getElementById("addressEdit").value = location.address;

	                // Set country, then load states for country then set selected state
	                const countrySelect = document.getElementById("countryEdit");
	                const stateSelect = document.getElementById("stateEdit");

	                countrySelect.value = location.countryid;

	                // Fetch states for selected country
	                fetch(`/states/byCountry?countryid=${location.countryid}`)
	                  .then(response => response.json())
	                  .then(states => {
	                    let options = '<option value="">-SELECT-</option>';
	                    states.forEach(state => {
	                      options += `<option value="${state.id}">${state.name}</option>`;
	                    });
	                    stateSelect.innerHTML = options;

	                    // Set selected state
	                    stateSelect.value = location.stateid;
	                  });

	                document.getElementById("detailsEdit").value = location.details;

	                const editModal = new bootstrap.Modal(document.getElementById("editModal"));
	                editModal.show();
	              });
	          });
	        });

	        // --- Delete Modal ---
	        const deleteButtons = document.querySelectorAll(".deleteButton");
	        deleteButtons.forEach(function (button) {
	          button.addEventListener("click", function (event) {
	            event.preventDefault();
	            const href = this.getAttribute("href");
	            document.getElementById("confirmDeleteRecord").setAttribute("href", href);

	            const deleteModal = new bootstrap.Modal(document.getElementById("deleteModal"));
	            deleteModal.show();
	          });
	        });

	        // --- Add Modal: Load states when country changes ---
	        const countrySelectAdd = document.getElementById('countryid');
	        const stateSelectAdd = document.getElementById('stateid');
	        countrySelectAdd.addEventListener('change', function () {
	          const countryId = this.value;
	          if (!countryId) {
	            stateSelectAdd.innerHTML = '<option value="">-SELECT-</option>';
	            return;
	          }
	          fetch(`/states/byCountry?countryid=${countryId}`)
	            .then(response => response.json())
	            .then(states => {
	              let options = '<option value="">-SELECT-</option>';
	              states.forEach(state => {
	                options += `<option value="${state.id}">${state.name}</option>`;
	              });
	              stateSelectAdd.innerHTML = options;
	            })
	            .catch(() => {
	              stateSelectAdd.innerHTML = '<option value="">-SELECT-</option>';
	            });
	        });

	        // --- Edit Modal: Update states when country changes ---
	        const countrySelectEdit = document.getElementById('countryEdit');
	        const stateSelectEdit = document.getElementById('stateEdit');
	        countrySelectEdit.addEventListener('change', function () {
	          const countryId = this.value;
	          if (!countryId) {
	            stateSelectEdit.innerHTML = '<option value="">-SELECT-</option>';
	            return;
	          }
	          fetch(`/states/byCountry?countryid=${countryId}`)
	            .then(response => response.json())
	            .then(states => {
	              let options = '<option value="">-SELECT-</option>';
	              states.forEach(state => {
	                options += `<option value="${state.id}">${state.name}</option>`;
	              });
	              stateSelectEdit.innerHTML = options;
	            })
	            .catch(() => {
	              stateSelectEdit.innerHTML = '<option value="">-SELECT-</option>';
	            });
	        });
	      });
	    </script>	
    <!--end::Required Plugin(AdminLTE)--><!--begin::OverlayScrollbars Configure-->
    <script>
      const SELECTOR_SIDEBAR_WRAPPER = '.sidebar-wrapper';
      const Default = {
        scrollbarTheme: 'os-theme-light',
        scrollbarAutoHide: 'leave',
        scrollbarClickScroll: true,
      };
      document.addEventListener('DOMContentLoaded', function () {
        const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);

        // Disable OverlayScrollbars on mobile devices to prevent touch interference
        const isMobile = window.innerWidth <= 992;

        if (
          sidebarWrapper &&
          OverlayScrollbarsGlobal?.OverlayScrollbars !== undefined &&
          !isMobile
        ) {
          OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
            scrollbars: {
              theme: Default.scrollbarTheme,
              autoHide: Default.scrollbarAutoHide,
              clickScroll: Default.scrollbarClickScroll,
            },
          });
        }
      });
    </script>
    <!--end::OverlayScrollbars Configure-->
    <!--end::Script-->
  </body>
  <!--end::Body-->
</html>
